# Sistema de Exploits do Grey Hack: guia técnico definitivo

O sistema de exploits do Grey Hack funciona através de ataques de **buffer overflow** em endereços de memória vulneráveis de bibliotecas `.so`. Para que um exploit funcione, três elementos precisam coincidir perfeitamente: a versão exata da biblioteca-alvo, as condições do sistema remoto (como usuários ativos ou portas redirecionadas), e a presença da biblioteca `metaxploit.so` na máquina atacante. Este documento detalha cada componente do sistema, desde a anatomia interna dos exploits até procedimentos práticos de verificação de compatibilidade, fornecendo ao jogador todas as informações necessárias para dominar a mecânica de hacking do jogo.

## O que é um exploit e como ele funciona internamente

Exploits no Grey Hack são **programas executáveis** que exploram vulnerabilidades em bibliotecas de sistema. Essas vulnerabilidades existem como endereços de memória específicos (formato hexadecimal como `0x1DD41E37`) contendo valores inseguros que podem ser atacados através de buffer overflow. O sistema de vulnerabilidades é **proceduralmente gerado** pelo jogo, o que significa que tanto os nomes das vulnerabilidades quanto os endereços de memória são criados dinamicamente para cada versão de biblioteca.

O ciclo de vida de um exploit começa na HackShop, onde o jogador pode baixar exploits pré-compilados ou código-fonte (arquivos `.src`). A HackShop organiza os exploits por tipo de biblioteca e versão específica. Quando você seleciona um exploit para compra, há a opção de baixar o código-fonte para revisar e compilar manualmente usando o CodeEditor, ou simplesmente baixar a versão já compilada. A vantagem do código-fonte é a possibilidade de modificação e aprendizado; a do compilado é a praticidade imediata.

Internamente, todo exploit utiliza a biblioteca `metaxploit.so` como base. Esta biblioteca fornece as funções `net_use()` para conexões remotas, `load()` para bibliotecas locais, `scan()` para descobrir endereços vulneráveis, e `scan_address()` para revelar os detalhes de cada vulnerabilidade. O ataque propriamente dito é executado através do método `overflow()` do objeto MetaLib, que recebe o endereço de memória e o valor vulnerável como parâmetros.

## Os requisitos explicados com exemplos concretos

Cada vulnerabilidade possui **requisitos** que devem ser satisfeitos no sistema-alvo para que o exploit funcione. Quando você escaneia um endereço de memória, a saída mostra linhas começando com asterisco (`*`) que indicam essas condições. Se qualquer requisito não for atendido, o exploit simplesmente falha e retorna `null`.

O requisito **"active user"** exige que um usuário não-root esteja logado no sistema-alvo no momento do ataque. Para satisfazer essa condição, o jogador pode usar engenharia social através do programa Mail, selecionando o template "Online user" e enviando para um email do alvo. Isso faz com que um NPC faça login temporariamente. Já o requisito **"root active user"** é mais restritivo: exige que a conta root esteja ativa, requerendo o uso do template "Admin online" onde o nome da empresa corresponde ao nome do domínio.

O requisito **"registered users equal to X"** verifica se o sistema possui exatamente X contas de usuário registradas. Essa condição reflete o estado do diretório `/home` do alvo e não pode ser manipulada externamente. Se o sistema não tiver o número exato de usuários, será necessário buscar um exploit diferente com requisitos compatíveis. A comunidade apresenta certa ambiguidade sobre se "equal to 2" significa exatamente dois usuários ou no mínimo dois, mas a interpretação predominante é de correspondência exata.

O requisito de **"forwarded ports"** exige que o roteador tenha um número mínimo de portas redirecionadas para a máquina-vítima. Conforme explicação do desenvolvedor Kurouzu, esse requisito funciona simplesmente contando as portas abertas do roteador para a vítima, mesmo que não haja serviço ativo atrás dessas portas. Para verificar isso, use `nmap` no IP público e observe quantas portas aparecem direcionadas ao mesmo IP LAN.

## Como verificar compatibilidade passo a passo

O fluxo de verificação de compatibilidade segue uma sequência lógica que garante sucesso antes de executar qualquer exploit. Primeiro, utilize o comando `nmap` para descobrir as portas abertas e, crucialmente, as **versões exatas** das bibliotecas em execução:

```
nmap 192.168.1.100
```

A saída exibe uma tabela com porta, serviço, versão e IP LAN. Anote a versão exata da biblioteca que pretende atacar, pois o matching é **estritamente exato**. Um exploit para `libssh.so v1.0.0` não funcionará em `libssh.so v1.0.1`.

Para atacar o roteador (porta 0), use o comando `scanrouter` que revela a versão do `kernel_router.so`:

```
scanrouter 192.168.1.1
```

Com a versão em mãos, acesse a HackShop pelo navegador do jogo, navegue até a aba "Exploits", selecione o tipo de biblioteca no dropdown e digite a versão exata. Os resultados mostrarão exploits disponíveis com suas descrições indicando o tipo de acesso retornado (shell, computer, file) e os requisitos.

Para uma verificação manual mais detalhada, escreva um script de escaneamento:

```greyscript
metaxploit = include_lib("/lib/metaxploit.so")
net_session = metaxploit.net_use("192.168.1.100", 22)
metaLib = net_session.dump_lib
print("Biblioteca: " + metaLib.lib_name + " v" + metaLib.version)
addresses = metaxploit.scan(metaLib)
for addr in addresses
    vuln_info = metaxploit.scan_address(metaLib, addr)
    print(addr + "\n" + vuln_info)
end for
```

Este script conecta ao serviço, extrai a biblioteca, escaneia por endereços vulneráveis e exibe os detalhes de cada vulnerabilidade incluindo todos os requisitos. Leia cada linha com `*` para identificar o que precisa ser satisfeito.

Funções úteis do objeto NetSession permitem verificar condições antes de atacar: `net_session.is_any_active_user()` retorna 1 se há usuário ativo, `net_session.is_root_active_user()` verifica se root está ativo, e `net_session.get_num_users()` retorna o número de contas registradas.

## Tabela de referência rápida

| Requisito | Descrição | Como descobrir | Comando/Método |
|-----------|-----------|----------------|----------------|
| Versão da biblioteca | Deve corresponder exatamente | Scanner de portas | `nmap [IP]` |
| Versão do kernel_router | Para exploits de roteador | Scanner de roteador | `scanrouter [IP]` |
| Active user | Usuário não-root logado | Verificação via NetSession | `net_session.is_any_active_user()` |
| Root active | Root deve estar logado | Verificação via NetSession | `net_session.is_root_active_user()` |
| Registered users | Número exato de contas | Contagem de usuários | `net_session.get_num_users()` |
| Forwarded ports | Portas redirecionadas | Contagem no roteador | `net_session.get_num_portforward()` |
| LAN IP (bounce) | IP interno do alvo | Scanner de portas | `nmap [IP]` mostra coluna LAN |

| Biblioteca | Serviço | Porta padrão |
|------------|---------|--------------|
| kernel_router.so | Roteador | 0 |
| libssh.so | SSH | 22 |
| libhttp.so | HTTP | 80 |
| libftp.so | FTP | 21 |
| libsmtp.so | SMTP | 25 |
| libsql.so | SQL | 3306 |
| kernel_module.so | Kernel local | N/A |
| init.so | Inicialização | N/A |
| net.so | Rede local | N/A |

## Diagnóstico quando o exploit não funciona

O erro mais comum é a **ausência do metaxploit.so** na máquina atacante. A mensagem "Can't find metaxploit library" indica que você precisa baixar essa biblioteca da HackShop (aba Tools) e salvá-la em `/lib`. Para exploits locais executados em máquinas remotas, o `metaxploit.so` também precisa estar presente no alvo, geralmente enviado para `/home/guest` via SCP ou outro método.

Quando o exploit retorna `null` silenciosamente, os requisitos não foram atendidos. Verifique cada condição listada no scan do endereço de memória. Se o requisito for "active user", utilize engenharia social para ativar um usuário. Se for "registered users equal to X" e o sistema não atende, não há como contornar; busque outro exploit ou outro vetor de ataque.

A mensagem **"This memory zone does not exist"** ocorre quando a biblioteca foi atualizada desde o último scan. Bibliotecas são atualizadas quando vulnerabilidades são reportadas através do `ExploitReport.exe`, gerando novas versões com novos endereços de memória. Faça um novo scan para obter os endereços atualizados.

Se um exploit funcionava ontem mas não hoje, verifique se houve atualização da biblioteca no alvo. Versões mais antigas do jogo (anteriores a v0.7.2901a) tinham um bug onde a lista de exploits mudava após sair e recarregar o jogo mesmo com versões idênticas; esse bug foi corrigido, mas problemas similares foram reportados esporadicamente.

Para situações onde a HackShop não possui exploits do tipo shell para uma biblioteca específica, existem duas alternativas: reportar exploits existentes via `ExploitReport.exe` para forçar atualizações de biblioteca que geram novas vulnerabilidades, ou escrever scripts personalizados usando a API metaxploit para descobrir e explorar vulnerabilidades manualmente.

## Mecânicas avançadas e segredos do sistema

O sistema de **regeneração de vulnerabilidades** permite manipular estrategicamente as vulnerabilidades disponíveis. Quando você reporta um exploit, a biblioteca é atualizada e novas vulnerabilidades com diferentes requisitos e tipos de retorno são geradas. Se precisar de um exploit shell mas a HackShop só oferece exploits file, reporte os existentes e aguarde a regeneração.

Para escaneamento de bibliotecas sem possuir a versão local, não é necessário baixar cada versão antiga. O método `net_use()` + `dump_lib` permite extrair a biblioteca diretamente do alvo remoto. Conforme explicado pela comunidade: "Se seu alvo tem aquela biblioteca antiga, aqui está sua biblioteca antiga". Isso economiza tempo e espaço de armazenamento.

O conceito de **objetos parciais** (pcomputer, prouter, pshell, pfile) foi introduzido na versão 0.8.4709a. Esses objetos possuem funcionalidade limitada comparados às versões completas, oferecendo apenas um subconjunto de métodos. Reconhecer o tipo de objeto retornado é crucial para determinar as próximas ações possíveis.

Exploits de roteador oferecem um vetor de ataque frequentemente subestimado. Através do `kernel_router.so`, é possível acessar diretamente o arquivo `/etc/passwd` do roteador, contornando a necessidade de portas abertas em máquinas internas. Além disso, mesmo com firewall ativo, a função `net_use()` consegue conectar-se ao roteador para escanear e executar vulnerabilidades de desativação de firewall, embora qualquer outro tipo de exploit falhe enquanto o firewall estiver habilitado.

A mecânica de **bounce** afeta ataques a bibliotecas locais de máquinas na mesma LAN. Quando atacando bibliotecas como `init.so` ou `kernel_module.so` após obter acesso inicial a uma rede, você precisa especificar o IP LAN alvo. O comando `nmap` no IP público mostra a coluna LAN indicando quais IPs internos correspondem a cada serviço.

Scripts da comunidade disponíveis no GitHub oferecem funcionalidades avançadas como cache de vulnerabilidades em JSON (salvando endereço, valor de buffer overflow e tipo de handle), automatização de ataques em lote, e bancos de dados de versões conhecidas de kernel_router. Ferramentas como Darkvalnar's Exploit Suite, 5hell Shell Emulator e o repositório GreyRepo (greyrepo.xyz) são recursos valiosos para jogadores avançados.

## Glossário de termos técnicos do jogo

**Buffer overflow**: Técnica de ataque que sobrescreve áreas de memória além do espaço alocado, explorando verificações inseguras no código. No Grey Hack, é o único tipo de ataque implementado para vulnerabilidades.

**dump_lib**: Método do objeto NetSession que extrai a biblioteca do serviço remoto como objeto MetaLib, permitindo escaneamento e exploração.

**Endereço de memória**: Identificador hexadecimal (ex: `0x1DD41E37`) que aponta para uma zona de memória vulnerável dentro de uma biblioteca.

**HackShop**: Loja virtual do jogo acessível via Browser.exe onde se obtêm ferramentas de hacking, exploits e missões.

**metaxploit.so**: Biblioteca fundamental para todo o sistema de exploits, fornecendo funções de conexão, escaneamento e ataque.

**MetaLib**: Objeto que representa uma biblioteca carregada em memória, contendo métodos como `overflow()` para execução de exploits.

**NetSession**: Objeto retornado por `net_use()` representando uma conexão de rede com um serviço remoto.

**overflow()**: Método do MetaLib que executa o ataque de buffer overflow, recebendo endereço de memória e valor vulnerável como parâmetros.

**Reverse shell (rshell)**: Conexão onde a vítima se conecta ao atacante, invertendo o fluxo normal. Útil para manter acesso persistente.

**scan_address()**: Função que analisa um endereço de memória específico, revelando o valor vulnerável e os requisitos do exploit.

**Shell object**: Tipo de retorno mais valioso de um exploit, oferecendo acesso terminal completo ao sistema-alvo.

**Valor vulnerável (unsecure value)**: String aleatória gerada pelo jogo (ex: "conserti", "bl_treel") que serve como chave para executar o exploit em determinado endereço de memória.

---

**Nível de confiança das informações**: Alto para mecânicas fundamentais (confirmadas em múltiplas fontes incluindo documentação oficial da API, guias da comunidade Steam com centenas de avaliações, e código-fonte no GitHub). Médio para detalhes específicos como interpretação exata de "registered users equal to X" (ambiguidade nas fontes comunitárias). As informações refletem o estado do jogo até as atualizações mais recentes documentadas (v0.8.x).

**Fontes principais**: Grey Hack Code Docs API (codedocs.ghtools.xyz), GreyScript Documentation, Steam Community Guides (Hacker's Handbook por nightparty, Basic Exploits with Scripting por IZackI, Viper 2024 In-depth Guide por zuuzuu), repositórios GitHub (Darkvalnar/greyscript, jhook777/5hell, r4cken/greyhack-scripts), e discussões oficiais no Steam.
